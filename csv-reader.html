<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù‚Ø§Ø±Ø¦ Ø¨ÙŠØ§Ù†Ø§Øª CSV - ØªØ­Ù…ÙŠÙ„ ÙƒØ§Ù…Ù„</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
            direction: rtl;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        .header p {
            color: #666;
            font-size: 1.1rem;
        }
        .upload-area {
            border: 3px dashed #ccc;
            padding: 60px;
            text-align: center;
            margin-bottom: 30px;
            border-radius: 15px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            transition: all 0.3s ease;
        }
        .upload-area.dragover {
            border-color: #007bff;
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            transform: scale(1.02);
        }
        .upload-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.7;
        }
        .btn {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            margin: 10px;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,123,255,0.3);
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,123,255,0.4);
        }
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        .btn.success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            box-shadow: 0 4px 15px rgba(40,167,69,0.3);
        }
        .btn.warning {
            background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
            color: #212529;
            box-shadow: 0 4px 15px rgba(255,193,7,0.3);
        }
        .stats {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            border: 1px solid rgba(33,150,243,0.3);
            box-shadow: 0 4px 15px rgba(33,150,243,0.1);
        }
        .stats h3 {
            color: #1976d2;
            margin-bottom: 15px;
            text-align: center;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-item {
            background: rgba(255,255,255,0.8);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid rgba(25,118,210,0.2);
        }
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #1976d2;
        }
        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }
        .data-preview {
            margin-top: 25px;
            max-height: 500px;
            overflow: auto;
            border: 2px solid #dee2e6;
            border-radius: 12px;
            background: white;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }
        th, td {
            border: 1px solid #dee2e6;
            padding: 12px 8px;
            text-align: right;
        }
        th {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            font-weight: bold;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        tr:nth-child(even) {
            background: #f8f9fa;
        }
        tr:hover {
            background: #e3f2fd;
        }
        .progress-container {
            margin: 20px 0;
            background: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            height: 30px;
            position: relative;
        }
        .progress-bar {
            height: 100%;
            background: linear-gradient(45deg, #28a745, #20c997);
            width: 0%;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        .alert {
            padding: 15px;
            margin: 15px 0;
            border: 1px solid transparent;
            border-radius: 8px;
        }
        .alert-success {
            color: #155724;
            background-color: #d4edda;
            border-color: #c3e6cb;
        }
        .alert-info {
            color: #0c5460;
            background-color: #d1ecf1;
            border-color: #bee5eb;
        }
        .alert-warning {
            color: #856404;
            background-color: #fff3cd;
            border-color: #ffeaa7;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š Ù‚Ø§Ø±Ø¦ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©</h1>
            <p>Ø±ÙØ¹ ÙˆØªØ­Ù„ÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ø£Ø­ÙƒØ§Ù… Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© - ØªØ­Ù…ÙŠÙ„ ÙƒØ§Ù…Ù„</p>
        </div>
        
        <div class="upload-area" id="uploadArea">
            <div class="upload-icon">ğŸ“</div>
            <p style="font-size: 1.2rem; margin-bottom: 10px;">Ø§Ø³Ø­Ø¨ Ù…Ù„Ù arabicljptraindata.csv Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ø¶ØºØ· Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±</p>
            <p style="color: #666; margin-bottom: 20px;">Ø³ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù…Ù„Ù</p>
            <input type="file" id="fileInput" accept=".csv" style="display: none;">
            <button class="btn" onclick="document.getElementById('fileInput').click()">
                ğŸ“‚ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù CSV
            </button>
        </div>
        
        <div id="progress" style="display: none;">
            <div class="progress-container">
                <div class="progress-bar" id="progressBar">0%</div>
            </div>
        </div>
        
        <div id="stats" class="stats" style="display: none;"></div>
        <div id="preview" class="data-preview" style="display: none;"></div>
        <div id="actions" style="text-align: center; margin-top: 20px; display: none;">
            <button class="btn success" id="updateBackend" onclick="updateBackend()">
                ğŸš€ ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„Ù†Ø¸Ø§Ù…
            </button>
            <button class="btn" onclick="exportJSON()">ğŸ“„ ØªØµØ¯ÙŠØ± JSON</button>
            <button class="btn warning" onclick="location.reload()">ğŸ”„ Ù…Ù„Ù Ø¬Ø¯ÙŠØ¯</button>
        </div>
        
        <div id="alerts"></div>
    </div>

    <script>
        let csvData = null;
        let parsedData = null;
        let isUploading = false;

        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');

        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) handleFile(files[0]);
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) handleFile(e.target.files[0]);
        });

        function showAlert(message, type = 'info') {
            const alertsContainer = document.getElementById('alerts');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            alertsContainer.appendChild(alert);
            setTimeout(() => alert.remove(), 5000);
        }

        function updateProgress(percent, text) {
            const progressContainer = document.getElementById('progress');
            const progressBar = document.getElementById('progressBar');
            progressContainer.style.display = 'block';
            progressBar.style.width = percent + '%';
            progressBar.textContent = text || percent + '%';
        }

        function handleFile(file) {
            if (!file.name.endsWith('.csv')) {
                showAlert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù CSV ÙÙ‚Ø·', 'warning');
                return;
            }

            isUploading = true;
            showAlert(`Ø¨Ø¯Ø¡ ØªØ­Ù„ÙŠÙ„ Ù…Ù„Ù: ${file.name}`, 'info');
            updateProgress(10, 'Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù...');

            const reader = new FileReader();
            reader.onload = function(e) {
                updateProgress(30, 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
                csvData = e.target.result;
                
                setTimeout(() => {
                    parseCSV(csvData);
                    showStats();
                    showPreview();
                    showActions();
                    updateProgress(100, 'ØªÙ… Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!');
                    
                    setTimeout(() => {
                        document.getElementById('progress').style.display = 'none';
                        isUploading = false;
                    }, 1000);
                }, 100);
            };
            
            reader.onerror = () => {
                showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù', 'warning');
                isUploading = false;
            };
            
            reader.readAsText(file, 'utf-8');
        }

        function parseCSV(csvText) {
            const lines = csvText.split('\n').filter(line => line.trim());
            const headers = parseCSVLine(lines[0]);
            
            parsedData = { headers: headers, rows: [] };

            for (let i = 1; i < lines.length; i++) {
                const values = parseCSVLine(lines[i]);
                if (values.length >= headers.length) {
                    const row = {};
                    headers.forEach((header, index) => {
                        row[header] = values[index] || '';
                    });
                    parsedData.rows.push(row);
                }
                
                if (i % 1000 === 0) {
                    const progress = 50 + (i / (lines.length - 1)) * 30;
                    updateProgress(Math.round(progress), `Ù…Ø¹Ø§Ù„Ø¬Ø© ${i} Ù…Ù† ${lines.length - 1} ØµÙ...`);
                }
            }
        }

        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim().replace(/^"|"$/g, ''));
                    current = '';
                } else {
                    current += char;
                }
            }
            result.push(current.trim().replace(/^"|"$/g, ''));
            return result;
        }

        function showStats() {
            const statsDiv = document.getElementById('stats');
            statsDiv.style.display = 'block';
            
            const totalRows = parsedData.rows.length;
            const nonEmptyRows = parsedData.rows.filter(row => 
                Object.values(row).some(value => value && value.trim())
            ).length;

            statsDiv.innerHTML = `
                <h3>ğŸ“Š ØªØ­Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„ Ù„Ù„Ù…Ù„Ù:</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-number">${totalRows.toLocaleString()}</div>
                        <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØµÙÙˆÙ</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">${nonEmptyRows.toLocaleString()}</div>
                        <div class="stat-label">ØµÙÙˆÙ Ø¨Ù‡Ø§ Ø¨ÙŠØ§Ù†Ø§Øª</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">${parsedData.headers.length}</div>
                        <div class="stat-label">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">100%</div>
                        <div class="stat-label">Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ­Ù…ÙŠÙ„</div>
                    </div>
                </div>
                <div class="alert alert-success" style="text-align: center;">
                    âœ… ØªÙ… ØªØ­Ù„ÙŠÙ„ ${totalRows.toLocaleString()} Ø­ÙƒÙ… Ù‚Ø§Ù†ÙˆÙ†ÙŠ - Ø¬Ø§Ù‡Ø² Ù„ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!
                </div>
            `;
        }

        function showPreview() {
            const previewDiv = document.getElementById('preview');
            previewDiv.style.display = 'block';
            
            let html = '<h3 style="padding: 15px; background: #f8f9fa; margin: 0;">ğŸ‘ï¸ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ø£ÙˆÙ„ 10 ØµÙÙˆÙ):</h3><table><thead><tr>';
            
            parsedData.headers.forEach(header => {
                html += `<th>${header}</th>`;
            });
            html += '</tr></thead><tbody>';
            
            parsedData.rows.slice(0, 10).forEach(row => {
                html += '<tr>';
                parsedData.headers.forEach(header => {
                    const cellValue = row[header] || '';
                    const displayValue = cellValue.length > 100 ? cellValue.substring(0, 100) + '...' : cellValue;
                    html += `<td>${displayValue}</td>`;
                });
                html += '</tr>';
            });
            
            html += '</tbody></table>';
            previewDiv.innerHTML = html;
        }

        function showActions() {
            document.getElementById('actions').style.display = 'block';
        }

        function updateBackend() {
            const btn = document.getElementById('updateBackend');
            btn.disabled = true;
            btn.textContent = 'â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...';
            
            showAlert(`Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ ${parsedData.rows.length.toLocaleString()} Ø­ÙƒÙ… Ø¥Ù„Ù‰ Ø§Ù„Ù†Ø¸Ø§Ù…...`, 'info');
            updateProgress(0, 'Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„...');

            const backendData = {
                headers: parsedData.headers,
                totalRows: parsedData.rows.length,
                allData: parsedData.rows  // Ø¥Ø±Ø³Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            };
            
            fetch('http://localhost:5000/api/update-data', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(backendData)
            })
            .then(response => response.json())
            .then(data => {
                updateProgress(100, 'ØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!');
                showAlert(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${data.loadedJudgments.toLocaleString()} Ø­ÙƒÙ… Ø¨Ù†Ø¬Ø§Ø­!`, 'success');
                btn.textContent = 'âœ… ØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­';
                btn.classList.add('success');
                
                setTimeout(() => {
                    document.getElementById('progress').style.display = 'none';
                }, 2000);
            })
            .catch(error => {
                console.error('Error:', error);
                showAlert('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'warning');
                btn.disabled = false;
                btn.textContent = 'ğŸš€ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©';
            });
        }

        function exportJSON() {
            const dataStr = JSON.stringify(parsedData.rows, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', `arabic_legal_judgments_${new Date().toISOString().split('T')[0]}.json`);
            linkElement.click();
            showAlert('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!', 'success');
        }
    </script>
</body>
</html>
